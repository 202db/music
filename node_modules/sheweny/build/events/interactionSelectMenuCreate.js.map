{"version":3,"file":"interactionSelectMenuCreate.js","sourceRoot":"","sources":["../../src/events/interactionSelectMenuCreate.ts"],"names":[],"mappings":"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","sourcesContent":["import { INHIBITOR_TYPE, SELECT_EVENTS } from '../constants/constants.js';\nimport { ShewenyError } from '../helpers/index.js';\nimport { Collection, SelectMenuInteraction } from 'discord.js';\nimport type { ShewenyClient } from '../client/Client.js';\nimport type { Inhibitor, SelectMenu } from '../structures/index.js';\nexport default async function run(client: ShewenyClient, interaction: SelectMenuInteraction) {\n  try {\n    if (!client.collections.selectMenus) return;\n\n    const selects: SelectMenu[] = [];\n    for (const [, structure] of client.collections.selectMenus) {\n      if (!structure || (structure && !structure.length)) return;\n      for (const select of structure) {\n        for (const customId of select.customId) {\n          if (!(customId instanceof RegExp) && customId === interaction.customId) {\n            selects.push(select);\n          } else if (customId instanceof RegExp && customId.test(interaction.customId)) {\n            customId.lastIndex = 0;\n            selects.push(select);\n          }\n        }\n      }\n    }\n\n    if (!selects || (selects && !selects.length)) return;\n    for (const selectMenu of selects) {\n      await (async () => {\n        if (!selectMenu) return;\n        if (selectMenu.before) await selectMenu.before(interaction);\n\n        /**\n         * Handle inhibitors\n         */\n        const inhibitorsCollection = client.collections.inhibitors?.filter((is: Inhibitor[]) => {\n          for (const i of is) {\n            return i.type.includes(INHIBITOR_TYPE.select) || i.type.includes(INHIBITOR_TYPE.all);\n          }\n          return false;\n        });\n        const inhibitorsArray: Inhibitor[] = [];\n        for (const [, inhibitors] of inhibitorsCollection) {\n          if (inhibitors && inhibitors.length) {\n            for (const inhibitor of inhibitors) {\n              inhibitorsArray.push(inhibitor);\n            }\n          }\n        }\n        if (inhibitorsArray && inhibitorsArray.length) {\n          const sorted = inhibitorsArray.sort((a, b) => b.priority - a.priority);\n          for (const i of sorted) {\n            if (!(await i.execute(selectMenu, interaction))) return await i.onFailure(selectMenu, interaction);\n          }\n        }\n        /* ---------------COOLDOWNS--------------- */\n        if (!client.admins?.includes(interaction.user.id)) {\n          if (!client.cooldowns.buttons.has(selectMenu.customId)) {\n            client.cooldowns.buttons.set(selectMenu.customId, new Collection<string, number>());\n          }\n\n          const timeNow = Date.now();\n          const tStamps = client.cooldowns.buttons.get(selectMenu.customId);\n          const cdAmount = (selectMenu.cooldown || 0) * 1000;\n\n          if (tStamps) {\n            if (tStamps.has(interaction.user.id)) {\n              const cdExpirationTime = (tStamps.get(interaction.user.id) || 0) + cdAmount;\n              if (timeNow < cdExpirationTime) {\n                // const timeLeft = (cdExpirationTime - timeNow) / 1000;\n                return client.managers.buttons?.emit(SELECT_EVENTS.cooldownLimit, interaction, cdExpirationTime - timeNow);\n              }\n            }\n\n            tStamps.set(interaction.user.id, timeNow);\n            setTimeout(() => tStamps.delete(interaction.user.id), cdAmount);\n          }\n        }\n        await selectMenu.execute(interaction);\n      })();\n    }\n  } catch (err) {\n    const e = err as Error;\n    new ShewenyError(client, e);\n  }\n}\n"]}